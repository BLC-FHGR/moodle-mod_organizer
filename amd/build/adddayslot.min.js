define(["jquery"],function(a){var b=function(){this.totalslots=0,this.displayallslots=0,this.totalday="",this.totaltotal="",this.current="0"},c=new b;return c.init=function(b){function d(b){var c=a(b.target).attr("name"),d=parseInt(c.replace("newslots[","")),g=parseInt(a("select[name='newslots["+d+"][day]']").val()),h=parseInt(a("select[name='newslots["+d+"][dayto]']").val()),i=parseInt(a("select[name='newslots["+d+"][from]']").val());if(g!=-1&&h==-1){for(var n=k(),p=l(),q=n;q<=p;q=o(1e3*q,1)){var r=new Date(1e3*q),s=r.getDay(),t=s?s-1:6;if(g==t)break}var u=r/1e3+i+m(),v=new Date(1e3*u),w=v.getDay(),x=w?w-1:6;a("select[name='newslots["+d+"][dayto]']").val(x);var y=v.getHours(),z=v.getMinutes()+60*y;z=z%5?z+(5-z%5):z;var A=60*z;a("select[name='newslots["+d+"][to]']").val(A)}g=parseInt(a("select[name='newslots["+d+"][day]']").val()),h=parseInt(a("select[name='newslots["+d+"][dayto]']").val()),g!=-1&&h!=-1?e(d):f(d),j()}function e(b){var d=h(b),e=i();e*=d;var f=c.totalday.replace("xxx",d.toString()).replace("yyy",e.toString());a("span[name='forecastday_"+b+"']").html(f),a("span[name='newslots_"+b+"']").html(d.toString()),a("span[name='newpax_"+b+"']").html(e.toString())}function f(b){var d=0,e=0,f=c.totalday.replace("xxx",d.toString()).replace("yyy",e.toString());a("span[name='forecastday_"+b+"']").html(f),a("span[name='newslots_"+b+"']").html(d.toString()),a("span[name='newpax_"+b+"']").html(e.toString())}function g(){for(var a=0;a<c.current;a++)e(a);j()}function h(b){var c=parseInt(a("select[name^='newslots["+b+"][day]']").val());if(c==-1)return 0;var d=parseInt(a("select[name^='newslots["+b+"][dayto]']").val());if(d==-1)return 0;var e,f,g,h,i,j,p=k(),q=l(),r=parseInt(a("select[name='newslots["+b+"][from]']").val()),s=parseInt(a("select[name='newslots["+b+"][to]']").val()),t=m(),u=t+n(),v=0;for(f=p;f<=q;f=o(1e3*f,1))if(g=new Date(1e3*f),e=g.getDay()?g.getDay()-1:6,c==e){for(h=f+r,i=f+86400*(d-c)+s;i<h;)i+=604800;if(!(h<p||h>q))for(j=h;j+t<=i;j+=u)v++}return v}function i(){var b=a("input[name=maxparticipants]").val();return a.isNumeric(b)?b:0}function j(){var b=0,d=0;a("span[name^='newslots_']").each(function(){var c=parseInt(a(this).html());0==isNaN(c)&&(b+=c)}),a("span[name^='newpax_']").each(function(){var b=parseInt(a(this).html());0==isNaN(b)&&(d+=b)});var e=c.totaltotal.replace("xxx",b.toString()).replace("yyy",d.toString());a("div[name='organizer_newslots_forecasttotal']").html(e)}function k(){var b=a("select[name='startdate[day]']").val(),c=a("select[name='startdate[month]']").val()-1,d=a("select[name='startdate[year]']").val(),e=new Date(d,c,b);return e.getTime()/1e3}function l(){var b=a("select[name='enddate[day]']").val(),c=a("select[name='enddate[month]']").val()-1,d=a("select[name='enddate[year]']").val(),e=new Date(d,c,b);return e.getTime()/1e3+86399}function m(){var b=parseInt(a("input[name='duration[number]']").val()),c=parseInt(a("select[name='duration[timeunit]']").val());if(isNaN(b))return 0;var d=b*c;return d}function n(){var b=parseInt(a("input[name='gap[number]']").val()),c=parseInt(a("select[name='gap[timeunit]']").val());isNaN(b)&&(b=0);var d=b*c;return d}function o(a,b){var c=new Date(a);return c.setDate(c.getDate()+b),c.getTime()/1e3}if(c.totalslots=b.totalslots,c.displayallslots=b.displayallslots,c.totalday=b.totalday,c.totaltotal=b.totaltotal,0==c.displayallslots){for(var p=c.totalslots-1;p>0&&a("#id_newslots_"+String(p)+"_day").val()==-1;p--)a("#id_newslots_"+String(p)+"_day").closest(".form-group.row.fitem").hide(),a("#fgroup_id_slotgroup"+String(p)).hide();p<c.totalslots-1&&a("#id_addday").hide(),a("[id^=id_newslots_]").change(function(){var b=a(this).attr("id"),d=parseInt(b.split("_")[2])+1;d>c.current&&(a("#id_newslots_"+String(d)+"_day").closest(".form-group.row.fitem").show(),a("#fgroup_id_slotgroup"+String(d)).show(),d==c.totalslots&&a("#id_addday").show(),c.current++)})}else c.current=c.totalslots,g();a('[name^="newslots"]').not(":checkbox").on("change",d),a('input[name^="duration"]').on("change",g),a('select[name^="duration"]').on("change",g),a('input[name^="gap"]').on("change",g),a('select[name^="gap"]').on("change",g),a('input[name="maxparticipants"]').on("change",g),a('select[name^="startdate"]').on("change",g),a('select[name^="enddate"]').on("change",g),1==a("#id_now").prop("checked")&&(a("[name^=availablefrom]").prop("disabled",!0),a("#id_availablefrom_timeunit").prop("disabled",!0))},c});