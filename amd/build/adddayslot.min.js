define ("mod_organizer/adddayslot",["jquery"],function(a){var b=new function Adddayslot(){this.totalslots=0;this.displayallslots=0;this.totalday="";this.totaltotal="";this.current="0"};b.init=function(c){b.totalslots=c.totalslots;b.displayallslots=c.displayallslots;b.totalday=c.totalday;b.totaltotal=c.totaltotal;b.relativedeadline=c.relativedeadline;b.relativedeadlinestring=c.relativedeadlinestring;b.allowcreationofpasttimeslots=c.allowcreationofpasttimeslots;b.pasttimeslotsstring=c.pasttimeslotsstring;if(0==b.displayallslots){for(var q=b.totalslots-1;0<q;q--){if(-1==a("#id_newslots_"+(q+"")+"_day").val()){a("#id_newslots_"+(q+"")+"_day").closest(".form-group.row.fitem").hide();a("#fgroup_id_slotgroup"+(q+"")).hide()}else{break}}if(q<b.totalslots-1){a("#id_addday").hide()}a("[id^=id_newslots_]").change(function(){var c=a(this).attr("id"),d=parseInt(c.split("_")[2])+1;if(d>b.current){a("#id_newslots_"+(d+"")+"_day").closest(".form-group.row.fitem").show();a("#fgroup_id_slotgroup"+(d+"")).show();if(d==b.totalslots){a("#id_addday").show()}b.current++}})}else{b.current=b.totalslots;g()}a("[name^=\"newslots\"]").not(":checkbox").on("change",d);a("input[name^=\"duration\"]").on("change",g);a("select[name^=\"duration\"]").on("change",g);a("input[name^=\"gap\"]").on("change",g);a("select[name^=\"gap\"]").on("change",g);a("input[name=\"maxparticipants\"]").on("change",g);a("select[name^=\"startdate\"]").on("change",g);a("select[name^=\"enddate\"]").on("change",g);if(!0==a("#id_now").prop("checked")){a("[name^=availablefrom]").prop("disabled",!0);a("#id_availablefrom_timeunit").prop("disabled",!0)}function d(b){var c=a(b.target).attr("name"),d=parseInt(c.replace("newslots[","")),g=parseInt(a("select[name='newslots["+d+"][day]']").val()),h=parseInt(a("select[name='newslots["+d+"][dayto]']").val()),i=parseInt(a("select[name='newslots["+d+"][from]']").val());if(-1!=g&&-1==h||-1!=c.indexOf("[from]")){for(var j=l(),o=m(),q=j;q<=o;q=p(1e3*q,1)){var r=new Date(1e3*q),s=r.getDay(),t=s?s-1:6;if(g==t){break}}var u=r/1e3+i+n(),v=new Date(1e3*u),w=v.getDay(),x=w?w-1:6;a("select[name='newslots["+d+"][dayto]']").val(x);var y=v.getHours(),z=v.getMinutes()+60*y;z=z%5?z+(5-z%5):z;var A=60*z;a("select[name='newslots["+d+"][to]']").val(A)}g=parseInt(a("select[name='newslots["+d+"][day]']").val());h=parseInt(a("select[name='newslots["+d+"][dayto]']").val());if(-1!=g&&-1!=h){e(d)}else{f(d)}k()}function e(c){var d=h(c),e=d[0],f=d[1],g=d[2],i=j();i=i*e;var k=b.totalday.replace("xxx",e.toString()).replace("yyy",i.toString());if(0<f){k+=" ("+b.relativedeadlinestring.replace("xxx",f.toString())+")"}if(0<g){k+=" ("+b.pasttimeslotsstring.replace("xxx",g.toString())+")"}a("span[name='forecastday_"+c+"']").html(k);a("span[name='newslots_"+c+"']").html(e.toString());a("span[name='newpax_"+c+"']").html(i.toString())}function f(c){var d=0,e=b.totalday.replace("xxx",0 .toString()).replace("yyy",d.toString());a("span[name='forecastday_"+c+"']").html(e);a("span[name='newslots_"+c+"']").html(0 .toString());a("span[name='newpax_"+c+"']").html(d.toString())}function g(){for(var a=0;a<b.current;a++){e(a)}k()}function h(c){var d=parseInt(a("select[name^='newslots["+c+"][day]']").val());if(-1==d){return 0}var e=parseInt(a("select[name^='newslots["+c+"][dayto]']").val());if(-1==e){return 0}var f=l(),g=m(),h=parseInt(a("select[name='newslots["+c+"][from]']").val()),i=parseInt(a("select[name='newslots["+c+"][to]']").val()),j=n(),k=j+o(),q,r,s,t,u,v,w=0,x=0,y=0;for(r=f;r<=g;r=p(1e3*r,1)){s=new Date(1e3*r);q=s.getDay()?s.getDay()-1:6;if(d!=q){continue}t=r+h;u=r+86400*(e-d)+i;while(u<t){u+=604800}if(t<f||t>g){continue}var z=new Date,A=z.getTime()/1e3;for(v=t;v+j<=u;v+=k){if(v-A<b.relativedeadline&&0<v-A){x++}else if(0>v-A&&0==b.allowcreationofpasttimeslots){y++}else{w++}}}var B=[w,x,y];return B}function j(){var b=a("input[name=maxparticipants]").val();if(a.isNumeric(b)){return b}else{return 0}}function k(){var c=0,d=0;a("span[name^='newslots_']").each(function(){var b=parseInt(a(this).html());if(!1==isNaN(b)){c+=b}});a("span[name^='newpax_']").each(function(){var b=parseInt(a(this).html());if(!1==isNaN(b)){d+=b}});var e=b.totaltotal.replace("xxx",c.toString()).replace("yyy",d.toString());a("div[name='organizer_newslots_forecasttotal']").html(e)}function l(){var b=a("select[name='startdate[day]']").val(),c=a("select[name='startdate[month]']").val()-1,d=a("select[name='startdate[year]']").val(),e=new Date(d,c,b);return e.getTime()/1e3}function m(){var b=a("select[name='enddate[day]']").val(),c=a("select[name='enddate[month]']").val()-1,d=a("select[name='enddate[year]']").val(),e=new Date(d,c,b);return e.getTime()/1e3+86399}function n(){var b=parseInt(a("input[name='duration[number]']").val()),c=parseInt(a("select[name='duration[timeunit]']").val());if(isNaN(b)){return 0}return b*c}function o(){var b=parseInt(a("input[name='gap[number]']").val()),c=parseInt(a("select[name='gap[timeunit]']").val());if(isNaN(b)){b=0}var d=b*c;return d}function p(a,b){var c=new Date(a);c.setDate(c.getDate()+b);return c.getTime()/1e3}};return b});
//# sourceMappingURL=adddayslot.min.js.map
