define(["jquery"],function(a){var b=function(){this.totalslots=0,this.displayallslots=0,this.totalday="",this.totaltotal="",this.current="0"},c=new b;return c.init=function(b){function d(b){var c=a(b.target),d=c.attr("name"),f=parseInt(d.replace("newslots[","")),g=parseInt(a("select[name='newslots["+f+"][day]']").val()),h=parseInt(a("select[name='newslots["+f+"][dayto]']").val()),j=parseInt(a("select[name='newslots["+f+"][from]']").val());if(g!=-1&&h==-1){var k;if(j<29700){var l=parseInt(a("input[name='duration[number]']").val()),m=parseInt(a("select[name='duration[timeunit]']").val()),n=l*m;k=j+n,a("select[name='newslots["+f+"][dayto]']").val(g),a("select[name='newslots["+f+"][to]']").val(k)}else{k=0;var o=(h+1)%6;a("select[name='newslots["+f+"][dayto]']").val(o),a("select[name='newslots["+f+"][to]']").val(k)}}g=parseInt(a("select[name='newslots["+f+"][day]']").val()),h=parseInt(a("select[name='newslots["+f+"][dayto]']").val()),g!=-1&&h!=-1&&(e(f),i())}function e(b){var d=g(b),e=h();e*=d;var f=c.totalday.replace("xxx",d.toString()).replace("yyy",e.toString());a("span[name='forecastday_"+b+"']").html(f),a("span[name='newslots_"+b+"']").html(d.toString()),a("span[name='newpax_"+b+"']").html(e.toString())}function f(){for(var a=0;a<c.current;a++)e(a);i()}function g(b){var c=a("select[name='startdate[day]']").val(),d=a("select[name='startdate[month]']").val()-1,e=a("select[name='startdate[year]']").val(),f=new Date(e,d,c),g=f.getTime()/1e3,h=a("select[name='enddate[day]']").val(),i=a("select[name='enddate[month]']").val()-1,j=a("select[name='enddate[year]']").val(),k=new Date(j,i,h),l=k.getTime()/1e3,m=parseInt(a("select[name^='newslots["+b+"][day]']").val());if(m==-1)return 0;var n=parseInt(a("select[name^='newslots["+b+"][dayto]']").val());if(n==-1)return 0;var o=parseInt(a("select[name='newslots["+b+"][from]']").val()),p=parseInt(a("select[name='newslots["+b+"][to]']").val()),q=parseInt(a("input[name='duration[number]']").val()),r=parseInt(a("select[name='duration[timeunit]']").val()),s=parseInt(a("input[name='gap[number]']").val()),t=parseInt(a("select[name='gap[timeunit]']").val());if(isNaN(q))return 0;var u=q*r;isNaN(s)&&(s=0);var v,w,x,y,z,A,B=s*t,C=u+B,D=0;for(w=g;w<=l;w+=86400)if(x=new Date(1e3*w),v=x.getDay()-1,v=v==-1?6:v,m==v&&(y=w+o,z=w+86400*(n-m)+p,z<y&&(z+=604800),!(y<g||y>l||z>l)))for(A=y;A+u<=z;A+=C)D++;return D}function h(){var b=a("input[name=maxparticipants]").val();return a.isNumeric(b)?b:0}function i(){var b=0,d=0;a("span[name^='newslots_']").each(function(){var c=parseInt(a(this).html());0==isNaN(c)&&(b+=c)}),a("span[name^='newpax_']").each(function(){var b=parseInt(a(this).html());0==isNaN(b)&&(d+=b)});var e=c.totaltotal.replace("xxx",b.toString()).replace("yyy",d.toString());a("div[name='organizer_newslots_forecasttotal']").html(e)}if(c.totalslots=b.totalslots,c.displayallslots=b.displayallslots,c.totalday=b.totalday,c.totaltotal=b.totaltotal,0==c.displayallslots){for(var j=c.totalslots-1;j>0&&a("#id_newslots_"+String(j)+"_day").val()==-1;j--)a("#id_newslots_"+String(j)+"_day").closest(".form-group.row.fitem").hide(),a("#fgroup_id_slotgroup"+String(j)).hide();j<c.totalslots-1&&a("#id_addday").hide(),a("[id^=id_newslots_]").change(function(){var b=a(this).attr("id"),d=parseInt(b.split("_")[2])+1;d>c.current&&(a("#id_newslots_"+String(d)+"_day").closest(".form-group.row.fitem").show(),a("#fgroup_id_slotgroup"+String(d)).show(),d==c.totalslots&&a("#id_addday").show(),c.current++)})}else c.current=c.totalslots,f();a('[name^="newslots"]').not(":checkbox").on("change",d),a('input[name^="duration"]').on("change",f),a('select[name^="duration"]').on("change",f),a('input[name^="gap"]').on("change",f),a('select[name^="gap"]').on("change",f),a('input[name="maxparticipants"]').on("change",f),a('select[name^="startdate"]').on("change",f),a('select[name^="enddate"]').on("change",f),1==a("#id_now").prop("checked")&&(a("[name^=availablefrom]").prop("disabled",!0),a("#id_availablefrom_timeunit").prop("disabled",!0))},c});