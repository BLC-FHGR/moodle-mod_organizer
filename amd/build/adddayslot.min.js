define(["jquery"],function(a){var b=function(){this.totalslots=0,this.displayallslots=0,this.totalday="",this.totaltotal="",this.current="0"},c=new b;return c.init=function(b){function d(b){var c=a(b.target),d=c.attr("name"),g=parseInt(d.replace("newslots[","")),h=parseInt(a("select[name='newslots["+g+"][day]']").val()),i=parseInt(a("select[name='newslots["+g+"][dayto]']").val()),k=parseInt(a("select[name='newslots["+g+"][from]']").val());if(h!=-1&&i==-1){var l,m=parseInt(a("input[name='duration[number]']").val()),n=parseInt(a("select[name='duration[timeunit]']").val()),o=m*n;if(l=k+o,3600==n)if(l>=86400){l-=86400;var p=(h+1)%6;a("select[name='newslots["+g+"][dayto]']").val(p)}else a("select[name='newslots["+g+"][dayto]']").val(h);else if(86400==n){l=k;var p=(h+m)%7;a("select[name='newslots["+g+"][dayto]']").val(p)}else a("select[name='newslots["+g+"][dayto]']").val(h);a("select[name='newslots["+g+"][to]']").val(l)}h=parseInt(a("select[name='newslots["+g+"][day]']").val()),i=parseInt(a("select[name='newslots["+g+"][dayto]']").val()),h!=-1&&i!=-1?e(g):f(g),j()}function e(b){var d=h(b),e=i();e*=d;var f=c.totalday.replace("xxx",d.toString()).replace("yyy",e.toString());a("span[name='forecastday_"+b+"']").html(f),a("span[name='newslots_"+b+"']").html(d.toString()),a("span[name='newpax_"+b+"']").html(e.toString())}function f(b){var d=0,e=0,f=c.totalday.replace("xxx",d.toString()).replace("yyy",e.toString());a("span[name='forecastday_"+b+"']").html(f),a("span[name='newslots_"+b+"']").html(d.toString()),a("span[name='newpax_"+b+"']").html(e.toString())}function g(){for(var a=0;a<c.current;a++)e(a);j()}function h(b){var c=a("select[name='startdate[day]']").val(),d=a("select[name='startdate[month]']").val()-1,e=a("select[name='startdate[year]']").val(),f=new Date(e,d,c),g=f.getTime()/1e3,h=a("select[name='enddate[day]']").val(),i=a("select[name='enddate[month]']").val()-1,j=a("select[name='enddate[year]']").val(),k=new Date(j,i,h),l=k.getTime()/1e3+86399,m=parseInt(a("select[name^='newslots["+b+"][day]']").val());if(m==-1)return 0;var n=parseInt(a("select[name^='newslots["+b+"][dayto]']").val());if(n==-1)return 0;var o=parseInt(a("select[name='newslots["+b+"][from]']").val()),p=parseInt(a("select[name='newslots["+b+"][to]']").val()),q=parseInt(a("input[name='duration[number]']").val()),r=parseInt(a("select[name='duration[timeunit]']").val()),s=parseInt(a("input[name='gap[number]']").val()),t=parseInt(a("select[name='gap[timeunit]']").val());if(isNaN(q))return 0;var u=q*r;isNaN(s)&&(s=0);var v,w,x,y,z,A,B=s*t,C=u+B,D=0;for(w=g;w<=l;w+=86400)if(x=new Date(1e3*w),v=x.getDay()-1,v=v==-1?6:v,m==v&&(y=w+o,z=w+86400*(n-m)+p,z<y&&(z+=604800),!(y<g||y>l||z>l)))for(A=y;A+u<=z;A+=C)D++;return D}function i(){var b=a("input[name=maxparticipants]").val();return a.isNumeric(b)?b:0}function j(){var b=0,d=0;a("span[name^='newslots_']").each(function(){var c=parseInt(a(this).html());0==isNaN(c)&&(b+=c)}),a("span[name^='newpax_']").each(function(){var b=parseInt(a(this).html());0==isNaN(b)&&(d+=b)});var e=c.totaltotal.replace("xxx",b.toString()).replace("yyy",d.toString());a("div[name='organizer_newslots_forecasttotal']").html(e)}if(c.totalslots=b.totalslots,c.displayallslots=b.displayallslots,c.totalday=b.totalday,c.totaltotal=b.totaltotal,0==c.displayallslots){for(var k=c.totalslots-1;k>0&&a("#id_newslots_"+String(k)+"_day").val()==-1;k--)a("#id_newslots_"+String(k)+"_day").closest(".form-group.row.fitem").hide(),a("#fgroup_id_slotgroup"+String(k)).hide();k<c.totalslots-1&&a("#id_addday").hide(),a("[id^=id_newslots_]").change(function(){var b=a(this).attr("id"),d=parseInt(b.split("_")[2])+1;d>c.current&&(a("#id_newslots_"+String(d)+"_day").closest(".form-group.row.fitem").show(),a("#fgroup_id_slotgroup"+String(d)).show(),d==c.totalslots&&a("#id_addday").show(),c.current++)})}else c.current=c.totalslots,g();a('[name^="newslots"]').not(":checkbox").on("change",d),a('input[name^="duration"]').on("change",g),a('select[name^="duration"]').on("change",g),a('input[name^="gap"]').on("change",g),a('select[name^="gap"]').on("change",g),a('input[name="maxparticipants"]').on("change",g),a('select[name^="startdate"]').on("change",g),a('select[name^="enddate"]').on("change",g),1==a("#id_now").prop("checked")&&(a("[name^=availablefrom]").prop("disabled",!0),a("#id_availablefrom_timeunit").prop("disabled",!0))},c});