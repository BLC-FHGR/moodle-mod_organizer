{"version":3,"sources":["../src/initinfobox.js"],"names":["define","$","config","log","instance","Initinfobox","student","init","param","toggle_all_slots","saveuserprefs","tablebody","showpastslots","is","showmyslotsonly","showfreeslotsonly","showhiddenslots","showregistrationsonly","find","show","hide","target","filter","val","toUpperCase","tr","i","j","td","text","found","length","getElementsByTagName","extracttext","indexOf","toggle_info","set_user_preference","noninforows","noneexist","anyvisible","each","css","element","last","img","clone","remove","end","first","attr","on","name","value","get","wwwroot","sesskey","pref","encodeURI","done","data","error"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/.\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle. If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package mod\n * @subpackage organizer\n * @copyright 2017 Thomas Niedermaier (thomas.niedermaier@gmail.com)\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Tab appointments view and students view: Load slot list according to view options stored in user prefs.\n */\n\n\ndefine(\n    ['jquery', 'core/config', 'core/log'], function($, config, log) {\n\n        /**\n     * @constructor\n     * @alias module:mod_organizer/initinfobox\n     */\n        var Initinfobox = function() {\n            this.student = 0;\n        };\n\n        var instance = new Initinfobox();\n\n        instance.init = function(param) {\n\n            instance.student = param; // Is user student or not.\n\n            // What happens when a view option checkbox is clicked or the filter field has been changed.\n            function toggle_all_slots(saveuserprefs) {\n                var tablebody = $('#slot_overview tbody');\n                var showpastslots = $('#show_past_slots').is(':checked');\n                var showmyslotsonly = $('#show_my_slots_only').is(':checked');\n                var showfreeslotsonly = $('#show_free_slots_only').is(':checked');\n                var showhiddenslots = $('#show_hidden_slots').is(':checked');\n                var showregistrationsonly = $('#show_registrations_only').is(':checked');\n\n                tablebody.find('tr').show();\n\n                if (showregistrationsonly) {\n                    tablebody.find('tr.not_registered').hide();\n                }\n\n                if (!instance.student) {\n                    if (!showhiddenslots) {\n                        tablebody.find('tr.unavailable').hide();\n                    }\n                }\n\n                if (!showpastslots) {\n                    tablebody.find('tr.past_due').hide();\n                }\n\n                if (showmyslotsonly) {\n                    if (!instance.student) {\n                        tablebody.find('tr.not_my_slot').hide();\n                    }\n                }\n\n                if (showfreeslotsonly) {\n                    tablebody.find('tr.not_free_slot').hide();\n                }\n\n                var target = $('.organizer_filtertable');\n                if (target) {\n                    var filter = target.val().toUpperCase();\n                    if (filter) {\n                        var tr = tablebody.find('tr:visible:not(.info)');\n                        // Loop through all table rows, and hide those who don't match the search query.\n                        var i, j, td, text, found;\n                        for (i = 0; i < tr.length; i++) {\n                            found = false;\n                            td = tr[i].getElementsByTagName(\"td\");\n                            if (td) {\n                                for (j = 0; j < td.length; j++) {\n                                    text = extracttext(td[j]);\n                                    if (text) {\n                                        if (text.toUpperCase().indexOf(filter) > -1) {\n                                            found = true;\n                                            break;\n                                        }\n                                    }\n                                }\n                            }\n                            if (!found) {\n                                $(tr[i]).hide();\n                            }\n                        }\n                    }\n                }\n\n                tablebody.show();\n\n                toggle_info();\n\n                if (saveuserprefs) {\n                    set_user_preference('mod_organizer_showhiddenslots', (showhiddenslots));\n                    if (!instance.student) {\n                        set_user_preference('mod_organizer_showmyslotsonly', (showmyslotsonly));\n                    }\n                    set_user_preference('mod_organizer_showfreeslotsonly', (showfreeslotsonly));\n                    set_user_preference('mod_organizer_showpasttimeslots', (showpastslots));\n                    set_user_preference('mod_organizer_showregistrationsonly', (showregistrationsonly));\n                }\n            }\n\n            function toggle_info() {\n                var tablebody = $('#slot_overview tbody');\n                var noninforows = tablebody.find('tr:not(.info)');\n                var noneexist = noninforows.length === 0;\n                var anyvisible = false;\n\n                noninforows.each(\n                    function() {\n                        if ($(this).css('display') !== 'none') {\n                            anyvisible = true;\n                        }\n                    }\n                );\n\n                var showpastslots = $('#show_past_slots').is(':checked');\n                var showmyslotsonly = $('#show_my_slots_only').is(':checked');\n\n                tablebody.find('tr.info').hide();\n                if (!anyvisible) {\n                    if (noneexist) {\n                        tablebody.find('tr.no_slots_defined').show();\n                    } else if (showpastslots && !showmyslotsonly) {\n                        tablebody.find('tr.no_slots').show();\n                    } else if (showpastslots && showmyslotsonly) {\n                        tablebody.find('tr.no_my_slots').show();\n                    } else {\n                        tablebody.find('tr.no_due_slots').show();\n                    }\n                }\n            }\n\n            // Extract visible text from 'element' down thru DOM tree.\n            function extracttext(element) {\n                var text, last, img;\n\n                last = $(element).clone().find(\"script,style\").remove().end();\n                text = last.text();\n                if (!text) {\n                    img = last.find('img:not(.icon)').first();\n                    var attr = img.attr('alt');\n                    if (typeof attr !== typeof undefined && attr !== false) {\n                        text = attr;\n                    }\n                }\n                return text;\n            }\n\n            $('#show_past_slots').on('click', function() { toggle_all_slots(true); });\n            $('#show_my_slots_only').on('click', function() { toggle_all_slots(true); });\n            $('#show_free_slots_only').on('click', function() { toggle_all_slots(true); });\n            $('#show_hidden_slots').on('click', function() { toggle_all_slots(true); });\n            $('#show_registrations_only').on('click', function() { toggle_all_slots(true); });\n            $('.organizer_filtertable').on('keyup', function() { toggle_all_slots(true); });\n\n            toggle_all_slots(false);\n\n            function set_user_preference(name, value) {\n\n                $.get(config.wwwroot + '/lib/ajax/setuserpref.php', {\n                    sesskey: config.sesskey,\n                    pref: encodeURI(name),\n                    value: encodeURI(value)\n                }, 'json').done(function(data) {\n                    if (data != 'OK') {\n                        log.error(data);\n                    }\n                });\n\n            }\n        };\n\n        return instance;\n\n    }\n);\n"],"file":"initinfobox.min.js"}