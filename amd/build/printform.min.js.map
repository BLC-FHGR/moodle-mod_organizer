{"version":3,"file":"printform.min.js","sources":["../src/printform.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/.\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle. If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * @package\r\n * @subpackage organizer\r\n * @copyright 2020 Thomas Niedermaier (thomas.niedermaier@gmail.com)\r\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n/**\r\n * In print form: Toggle columns (show/hide).\r\n */\r\n\r\n\r\ndefine(\r\n    ['jquery', 'core/config', 'core/log'], function($, config, log) {\r\n\r\n        /**\r\n     * @constructor\r\n     * @alias module:mod_organizer/printform\r\n     */\r\n        var Printform = function() {\r\n            this.iconminus = \"\";\r\n            this.iconplus = \"\";\r\n        };\r\n\r\n        var instance = new Printform();\r\n\r\n        instance.init = function(param) {\r\n\r\n            /**\r\n             * Writes expand icon (+) and hide icon (-) in every header cell. Every expand icon is set to hidden.\r\n             */\r\n            function init_header() {\r\n                var printpreview = $('#print_preview');\r\n                printpreview.find('th').find('a[name$=_cell]').each(function() {\r\n                    var name = $(this).attr(\"name\");\r\n                    var col = name.split(\"_\")[0];\r\n                    var iconminus = instance.iconminus.replace('xxx', col + '_thiconminus').replace('yyy', col);\r\n                    var iconplus = instance.iconplus.replace('xxx', col + '_thiconplus').replace('yyy', col);\r\n                    $(this).parent().append(iconminus).append(iconplus);\r\n                    $('#' + col + '_thiconplus').hide();\r\n                });\r\n                var $form = $('#organizer_main_cointainer form');\r\n                $('input[name=\"downloadfile\"]').click(function() { $form.attr('target', '_blank'); });\r\n                $('input[name=\"cancel\"]').click(function() { $form.attr('target', '_self'); });\r\n            }\r\n\r\n            /**\r\n             * During initialization of the table every column which is set to hidden in the user preferences\r\n             * will be hidden here.\r\n             */\r\n            function init_noprints() {\r\n                var printpreview = $('#print_preview');\r\n                printpreview.find('th').find('a[noprint*=1]').each(function() {\r\n                    var name = $(this).attr(\"name\");\r\n                    var col = name.split(\"_\")[0];\r\n                    $('#' + col + '_thiconminus').trigger(\"click\");\r\n                });\r\n            }\r\n\r\n            /**\r\n             * Stores the invisible columms of the print preview table in the moodle user preferences table.\r\n             */\r\n            function set_user_preference() {\r\n                var name = \"mod_organizer_noprintfields\";\r\n                var values = \"\";\r\n                $(\"img[id$='_thiconplus']\").not(':hidden').each(function() {\r\n                    values += $(this).attr(\"col\") + ',';\r\n                });\r\n                var cfg = {\r\n                    method: 'get',\r\n                    url: config.wwwroot + '/lib/ajax/setuserpref.php',\r\n                    data: {\r\n                        'sesskey': config.sesskey,\r\n                        'pref': encodeURI(name),\r\n                        'value': encodeURI(values)\r\n                    },\r\n                    dataType: 'json',\r\n                    beforeSend: function() {\r\n                        log.info(\"set user preference \" + name + \": \" + values, \"organizer\");\r\n                    },\r\n                    success: function() {\r\n                        log.info(\"set user preference OK\", \"organizer\");\r\n                    },\r\n                    error: function() {\r\n                        log.error(\"set user preference FAILED\", \"organizer\");\r\n                    }\r\n                };\r\n                $.ajax(cfg);\r\n            }\r\n\r\n            /**\r\n             * Hide a former visible column or show a former hidden column here.\r\n             * @param {object} e the click event of the + or - icon\r\n             */\r\n            function toggle_column(e) {\r\n                var target = $(e.target);\r\n                var col = target.attr('col');\r\n                var src = target.attr('src');\r\n                var hide;\r\n                if (src.indexOf(\"minus\") != -1) {\r\n                    hide = true;\r\n                    $('#' + col + '_thiconminus').hide();\r\n                    $('#' + col + '_thiconplus').show();\r\n                    $('a[name=' + col + '_cell]').hide();\r\n                } else {\r\n                    hide = false;\r\n                    $('#' + col + '_thiconplus').hide();\r\n                    $('#' + col + '_thiconminus').show();\r\n                    $('a[name=' + col + '_cell]').show();\r\n                }\r\n                var printpreview = $('#print_preview');\r\n                printpreview.find('span[name=\"' + col + '_cell\"]').each(\r\n                    function() {\r\n                        if (hide) {\r\n                            $(this).hide();\r\n                        } else {\r\n                            $(this).show();\r\n                        }\r\n                    }\r\n                );\r\n                set_user_preference();\r\n            }\r\n\r\n            instance.iconminus = param.iconminus;\r\n            instance.iconplus = param.iconplus;\r\n\r\n            init_header();\r\n\r\n            var printpreview = $('#print_preview');\r\n            printpreview.find('th').find('img[id*=_thicon]').on('click', toggle_column);\r\n\r\n            init_noprints();\r\n        };\r\n        return instance;\r\n\r\n    }\r\n);\r\n"],"names":["define","$","config","log","instance","iconminus","iconplus","init","param","find","each","col","this","attr","split","replace","parent","append","hide","$form","click","init_header","on","e","target","indexOf","show","name","values","not","cfg","method","url","wwwroot","data","sesskey","encodeURI","dataType","beforeSend","info","success","error","ajax","set_user_preference","trigger"],"mappings":";;;;;;AA2BAA,iCACI,CAAC,SAAU,cAAe,aAAa,SAASC,EAAGC,OAAQC,SAWnDC,SAAW,IALC,gBACPC,UAAY,QACZC,SAAW,WAKpBF,SAASG,KAAO,SAASC,OAiGrBJ,SAASC,UAAYG,MAAMH,UAC3BD,SAASE,SAAWE,MAAMF,oBA5FHL,EAAE,kBACRQ,KAAK,MAAMA,KAAK,kBAAkBC,MAAK,eAE5CC,IADOV,EAAEW,MAAMC,KAAK,QACTC,MAAM,KAAK,GACtBT,UAAYD,SAASC,UAAUU,QAAQ,MAAOJ,IAAM,gBAAgBI,QAAQ,MAAOJ,KACnFL,SAAWF,SAASE,SAASS,QAAQ,MAAOJ,IAAM,eAAeI,QAAQ,MAAOJ,KACpFV,EAAEW,MAAMI,SAASC,OAAOZ,WAAWY,OAAOX,UAC1CL,EAAE,IAAMU,IAAM,eAAeO,cAE7BC,MAAQlB,EAAE,mCACdA,EAAE,8BAA8BmB,OAAM,WAAaD,MAAMN,KAAK,SAAU,aACxEZ,EAAE,wBAAwBmB,OAAM,WAAaD,MAAMN,KAAK,SAAU,YAmFtEQ,GAEmBpB,EAAE,kBACRQ,KAAK,MAAMA,KAAK,oBAAoBa,GAAG,kBAnC7BC,OAIfL,KAHAM,OAASvB,EAAEsB,EAAEC,QACbb,IAAMa,OAAOX,KAAK,QAGO,GAFnBW,OAAOX,KAAK,OAEdY,QAAQ,UACZP,MAAO,EACPjB,EAAE,IAAMU,IAAM,gBAAgBO,OAC9BjB,EAAE,IAAMU,IAAM,eAAee,OAC7BzB,EAAE,UAAYU,IAAM,UAAUO,SAE9BA,MAAO,EACPjB,EAAE,IAAMU,IAAM,eAAeO,OAC7BjB,EAAE,IAAMU,IAAM,gBAAgBe,OAC9BzB,EAAE,UAAYU,IAAM,UAAUe,QAEfzB,EAAE,kBACRQ,KAAK,cAAgBE,IAAM,WAAWD,MAC/C,WACQQ,KACAjB,EAAEW,MAAMM,OAERjB,EAAEW,MAAMc,yBArDhBC,KAAO,8BACPC,OAAS,GACb3B,EAAE,0BAA0B4B,IAAI,WAAWnB,MAAK,WAC5CkB,QAAU3B,EAAEW,MAAMC,KAAK,OAAS,WAEhCiB,IAAM,CACNC,OAAQ,MACRC,IAAK9B,OAAO+B,QAAU,4BACtBC,KAAM,SACShC,OAAOiC,aACVC,UAAUT,YACTS,UAAUR,SAEvBS,SAAU,OACVC,WAAY,WACRnC,IAAIoC,KAAK,uBAAyBZ,KAAO,KAAOC,OAAQ,cAE5DY,QAAS,WACLrC,IAAIoC,KAAK,yBAA0B,cAEvCE,MAAO,WACHtC,IAAIsC,MAAM,6BAA8B,eAGhDxC,EAAEyC,KAAKZ,KAiCPa,MArEmB1C,EAAE,kBACRQ,KAAK,MAAMA,KAAK,iBAAiBC,MAAK,eAE3CC,IADOV,EAAEW,MAAMC,KAAK,QACTC,MAAM,KAAK,GAC1Bb,EAAE,IAAMU,IAAM,gBAAgBiC,QAAQ,aA8E3CxC"}