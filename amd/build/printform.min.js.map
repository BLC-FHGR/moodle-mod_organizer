{"version":3,"file":"printform.min.js","sources":["../src/printform.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/.\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle. If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * @package mod\r\n * @subpackage organizer\r\n * @copyright 2020 Thomas Niedermaier (thomas.niedermaier@gmail.com)\r\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n/**\r\n * In print form: Toggle columns (show/hide).\r\n */\r\n\r\n\r\ndefine(\r\n    ['jquery', 'core/config', 'core/log'], function($, config, log) {\r\n\r\n        /**\r\n     * @constructor\r\n     * @alias module:mod_organizer/printform\r\n     */\r\n        var Printform = function() {\r\n            this.iconminus = \"\";\r\n            this.iconplus = \"\";\r\n        };\r\n\r\n        var instance = new Printform();\r\n\r\n        instance.init = function(param) {\r\n\r\n            /**\r\n             * Writes expand icon (+) and hide icon (-) in every header cell. Every expand icon is set to hidden.\r\n             */\r\n            function init_header() {\r\n                var printpreview = $('#print_preview');\r\n                printpreview.find('th').find('a[name$=_cell]').each(function() {\r\n                    var name = $(this).attr(\"name\");\r\n                    var col = name.split(\"_\")[0];\r\n                    var iconminus = instance.iconminus.replace('xxx', col + '_thiconminus').replace('yyy', col);\r\n                    var iconplus = instance.iconplus.replace('xxx', col + '_thiconplus').replace('yyy', col);\r\n                    $(this).parent().append(iconminus).append(iconplus);\r\n                    $('#' + col + '_thiconplus').hide();\r\n                });\r\n                var $form = $('#organizer_main_cointainer form');\r\n                $('input[name=\"downloadfile\"]').click(function() { $form.attr('target', '_blank'); });\r\n                $('input[name=\"cancel\"]').click(function() { $form.attr('target', '_self'); });\r\n            }\r\n\r\n            /**\r\n             * During initialization of the table every column which is set to hidden in the user preferences\r\n             * will be hidden here.\r\n             */\r\n            function init_noprints() {\r\n                var printpreview = $('#print_preview');\r\n                printpreview.find('th').find('a[noprint*=1]').each(function() {\r\n                    var name = $(this).attr(\"name\");\r\n                    var col = name.split(\"_\")[0];\r\n                    $('#' + col + '_thiconminus').trigger(\"click\");\r\n                });\r\n            }\r\n\r\n            /**\r\n             * Stores the invisible columms of the print preview table in the moodle user preferences table.\r\n             */\r\n            function set_user_preference() {\r\n                var name = \"mod_organizer_noprintfields\";\r\n                var values = \"\";\r\n                $(\"img[id$='_thiconplus']\").not(':hidden').each(function() {\r\n                    values += $(this).attr(\"col\") + ',';\r\n                });\r\n                var cfg = {\r\n                    method: 'get',\r\n                    url: config.wwwroot + '/lib/ajax/setuserpref.php',\r\n                    data: {\r\n                        'sesskey': config.sesskey,\r\n                        'pref': encodeURI(name),\r\n                        'value': encodeURI(values)\r\n                    },\r\n                    dataType: 'json',\r\n                    beforeSend: function() {\r\n                        log.info(\"set user preference \" + name + \": \" + values, \"organizer\");\r\n                    },\r\n                    success: function() {\r\n                        log.info(\"set user preference OK\", \"organizer\");\r\n                    },\r\n                    error: function() {\r\n                        log.error(\"set user preference FAILED\", \"organizer\");\r\n                    }\r\n                };\r\n                $.ajax(cfg);\r\n            }\r\n\r\n            /**\r\n             * Hide a former visible column or show a former hidden column here.\r\n             * @param e the click event of the + or - icon\r\n             */\r\n            function toggle_column(e) {\r\n                var target = $(e.target);\r\n                var col = target.attr('col');\r\n                var src = target.attr('src');\r\n                var hide;\r\n                if (src.indexOf(\"minus\") != -1) {\r\n                    hide = true;\r\n                    $('#' + col + '_thiconminus').hide();\r\n                    $('#' + col + '_thiconplus').show();\r\n                    $('a[name=' + col + '_cell]').hide();\r\n                } else {\r\n                    hide = false;\r\n                    $('#' + col + '_thiconplus').hide();\r\n                    $('#' + col + '_thiconminus').show();\r\n                    $('a[name=' + col + '_cell]').show();\r\n                }\r\n                var printpreview = $('#print_preview');\r\n                printpreview.find('span[name=\"' + col + '_cell\"]').each(\r\n                    function() {\r\n                        if (hide) {\r\n                            $(this).hide();\r\n                        } else {\r\n                            $(this).show();\r\n                        }\r\n                    }\r\n                );\r\n                set_user_preference();\r\n            }\r\n\r\n            instance.iconminus = param.iconminus;\r\n            instance.iconplus = param.iconplus;\r\n\r\n            init_header();\r\n\r\n            var printpreview = $('#print_preview');\r\n            printpreview.find('th').find('img[id*=_thicon]').on('click', toggle_column);\r\n\r\n            init_noprints();\r\n        };\r\n        return instance;\r\n\r\n    }\r\n);\r\n"],"names":["define","$","config","log","instance","this","iconminus","iconplus","init","param","find","each","col","attr","split","replace","parent","append","hide","$form","click","init_header","on","e","target","indexOf","show","name","values","not","cfg","method","url","wwwroot","data","sesskey","pref","encodeURI","value","dataType","beforeSend","info","success","error","ajax","set_user_preference","trigger"],"mappings":";;;;;;AA2BAA,OACI,0BAAA,CAAC,SAAU,cAAe,aAAa,SAASC,EAAGC,OAAQC,KAMvD,IAKIC,SAAW,IALC,WACZC,KAAKC,UAAY,GACjBD,KAAKE,SAAW,IAgHpB,OA3GAH,SAASI,KAAO,SAASC,OAiGrBL,SAASE,UAAYG,MAAMH,UAC3BF,SAASG,SAAWE,MAAMF,SA7F1B,WACuBN,EAAE,kBACRS,KAAK,MAAMA,KAAK,kBAAkBC,MAAK,WAChD,IACIC,IADOX,EAAEI,MAAMQ,KAAK,QACTC,MAAM,KAAK,GACtBR,UAAYF,SAASE,UAAUS,QAAQ,MAAOH,IAAM,gBAAgBG,QAAQ,MAAOH,KACnFL,SAAWH,SAASG,SAASQ,QAAQ,MAAOH,IAAM,eAAeG,QAAQ,MAAOH,KACpFX,EAAEI,MAAMW,SAASC,OAAOX,WAAWW,OAAOV,UAC1CN,EAAE,IAAMW,IAAM,eAAeM,UAEjC,IAAIC,MAAQlB,EAAE,mCACdA,EAAE,8BAA8BmB,OAAM,WAAaD,MAAMN,KAAK,SAAU,aACxEZ,EAAE,wBAAwBmB,OAAM,WAAaD,MAAMN,KAAK,SAAU,WACrE,CAkFDQ,GAEmBpB,EAAE,kBACRS,KAAK,MAAMA,KAAK,oBAAoBY,GAAG,SAnCpD,SAAuBC,GACnB,IAGIL,KAHAM,OAASvB,EAAEsB,EAAEC,QACbZ,IAAMY,OAAOX,KAAK,QAGO,GAFnBW,OAAOX,KAAK,OAEdY,QAAQ,UACZP,MAAO,EACPjB,EAAE,IAAMW,IAAM,gBAAgBM,OAC9BjB,EAAE,IAAMW,IAAM,eAAec,OAC7BzB,EAAE,UAAYW,IAAM,UAAUM,SAE9BA,MAAO,EACPjB,EAAE,IAAMW,IAAM,eAAeM,OAC7BjB,EAAE,IAAMW,IAAM,gBAAgBc,OAC9BzB,EAAE,UAAYW,IAAM,UAAUc,QAEfzB,EAAE,kBACRS,KAAK,cAAgBE,IAAM,WAAWD,MAC/C,WACQO,KACAjB,EAAEI,MAAMa,OAERjB,EAAEI,MAAMqB,UAtDxB,WACI,IAAIC,KAAO,8BACPC,OAAS,GACb3B,EAAE,0BAA0B4B,IAAI,WAAWlB,MAAK,WAC5CiB,QAAU3B,EAAEI,MAAMQ,KAAK,OAAS,OAEpC,IAAIiB,IAAM,CACNC,OAAQ,MACRC,IAAK9B,OAAO+B,QAAU,4BACtBC,KAAM,CACFC,QAAWjC,OAAOiC,QAClBC,KAAQC,UAAUV,MAClBW,MAASD,UAAUT,SAEvBW,SAAU,OACVC,WAAY,WACRrC,IAAIsC,KAAK,uBAAyBd,KAAO,KAAOC,OAAQ,YAVtD,EAYNc,QAAS,WACLvC,IAAIsC,KAAK,yBAA0B,YAbjC,EAeNE,MAAO,WACHxC,IAAIwC,MAAM,6BAA8B,YAC3C,GAEL1C,EAAE2C,KAAKd,IACV,CAgCGe,EACH,IAtEsB5C,EAAE,kBACRS,KAAK,MAAMA,KAAK,iBAAiBC,MAAK,WAC/C,IACIC,IADOX,EAAEI,MAAMQ,KAAK,QACTC,MAAM,KAAK,GAC1Bb,EAAE,IAAMW,IAAM,gBAAgBkC,QAAQ,aA8E3C1C,QAEV"}