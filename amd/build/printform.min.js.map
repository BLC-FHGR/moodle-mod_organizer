{"version":3,"sources":["../src/printform.js"],"names":["define","$","config","log","instance","Printform","iconminus","iconplus","init","param","set_user_preference","values","not","each","attr","cfg","method","url","wwwroot","data","sesskey","encodeURI","dataType","beforeSend","info","success","error","ajax","printpreview","find","name","col","split","replace","parent","append","hide","$form","click","on","e","target","src","indexOf","show","trigger"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/.\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle. If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package mod\n * @subpackage organizer\n * @copyright 2020 Thomas Niedermaier (thomas.niedermaier@gmail.com)\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * In print form: Toggle columns (show/hide).\n */\n\n\ndefine(\n    ['jquery', 'core/config', 'core/log'], function($, config, log) {\n\n        /**\n     * @constructor\n     * @alias module:mod_organizer/printform\n     */\n        var Printform = function() {\n            this.iconminus = \"\";\n            this.iconplus = \"\";\n        };\n\n        var instance = new Printform();\n\n        instance.init = function(param) {\n\n            /**\n             * Writes expand icon (+) and hide icon (-) in every header cell. Every expand icon is set to hidden.\n             */\n            function init_header() {\n                var printpreview = $('#print_preview');\n                printpreview.find('th').find('a[name$=_cell]').each(function() {\n                    var name = $(this).attr(\"name\");\n                    var col = name.split(\"_\")[0];\n                    var iconminus = instance.iconminus.replace('xxx', col + '_thiconminus').replace('yyy', col);\n                    var iconplus = instance.iconplus.replace('xxx', col + '_thiconplus').replace('yyy', col);\n                    $(this).parent().append(iconminus).append(iconplus);\n                    $('#' + col + '_thiconplus').hide();\n                });\n                var $form = $('#organizer_main_cointainer form');\n                $('input[name=\"downloadfile\"]').click(function() { $form.attr('target', '_blank'); });\n                $('input[name=\"cancel\"]').click(function() { $form.attr('target', '_self'); });\n            }\n\n            /**\n             * During initialization of the table every column which is set to hidden in the user preferences\n             * will be hidden here.\n             */\n            function init_noprints() {\n                var printpreview = $('#print_preview');\n                printpreview.find('th').find('a[noprint*=1]').each(function() {\n                    var name = $(this).attr(\"name\");\n                    var col = name.split(\"_\")[0];\n                    $('#' + col + '_thiconminus').trigger(\"click\");\n                });\n            }\n\n            /**\n             * Stores the invisible columms of the print preview table in the moodle user preferences table.\n             */\n            function set_user_preference() {\n                var name = \"mod_organizer_noprintfields\";\n                var values = \"\";\n                $(\"img[id$='_thiconplus']\").not(':hidden').each(function() {\n                    values += $(this).attr(\"col\") + ',';\n                });\n                var cfg = {\n                    method: 'get',\n                    url: config.wwwroot + '/lib/ajax/setuserpref.php',\n                    data: {\n                        'sesskey': config.sesskey,\n                        'pref': encodeURI(name),\n                        'value': encodeURI(values)\n                    },\n                    dataType: 'json',\n                    beforeSend: function() {\n                        log.info(\"set user preference \" + name + \": \" + values, \"organizer\");\n                    },\n                    success: function() {\n                        log.info(\"set user preference OK\", \"organizer\");\n                    },\n                    error: function() {\n                        log.error(\"set user preference FAILED\", \"organizer\");\n                    }\n                };\n                $.ajax(cfg);\n            }\n\n            /**\n             * Hide a former visible column or show a former hidden column here.\n             * @param e the click event of the + or - icon\n             */\n            function toggle_column(e) {\n                var target = $(e.target);\n                var col = target.attr('col');\n                var src = target.attr('src');\n                var hide;\n                if (src.indexOf(\"minus\") != -1) {\n                    hide = true;\n                    $('#' + col + '_thiconminus').hide();\n                    $('#' + col + '_thiconplus').show();\n                    $('a[name=' + col + '_cell]').hide();\n                } else {\n                    hide = false;\n                    $('#' + col + '_thiconplus').hide();\n                    $('#' + col + '_thiconminus').show();\n                    $('a[name=' + col + '_cell]').show();\n                }\n                var printpreview = $('#print_preview');\n                printpreview.find('span[name=\"' + col + '_cell\"]').each(\n                    function() {\n                        if (hide) {\n                            $(this).hide();\n                        } else {\n                            $(this).show();\n                        }\n                    }\n                );\n                set_user_preference();\n            }\n\n            instance.iconminus = param.iconminus;\n            instance.iconplus = param.iconplus;\n\n            init_header();\n\n            var printpreview = $('#print_preview');\n            printpreview.find('th').find('img[id*=_thicon]').on('click', toggle_column);\n\n            init_noprints();\n        };\n        return instance;\n\n    }\n);\n"],"file":"printform.min.js"}